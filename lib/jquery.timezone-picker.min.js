(function(e){var t={},n={},r=null,i=null,s=null,o=null;t.init=function(t){var u=this;return n=e.extend({},e.fn.timezonePicker.defaults,t),r=n.timezone,u.each(function(t,r){i=r,s=document.getElementsByName(i.useMap.replace(/^#/,""))[0],e(i).wrap('<div class="timezone-picker"></div>').parent().css({position:"relative",width:e(i).width()+"px"}),n.pinUrl?o=e('<img src="'+n.pinUrl+'" />').appendTo(i.parentNode).css("display","none"):n.pin&&(o=e(i).parent().parent().find(n.pin).appendTo(i.parentNode).css("display","none")),e(s).find("area").click(function(){var t=this;if(o){o.css("display","block");var r=e(t).attr("data-pin").split(","),i=parseInt(o.width()/2),s=o.height();o.css({position:"absolute",left:r[0]-i+"px",top:r[1]-s+"px"})}if(n.target){var u=e(t).attr("data-timezone");u&&e(n.target).val(u)}if(n.countryTarget){var a=e(t).attr("data-country");a&&e(n.countryTarget).val(a)}return!1}),n.target&&e(n.target).bind("change",function(){u.timezonePicker("updateTimezone",e(this).val())});if(n.responsive){var a=null;e(window).resize(function(){a&&clearTimeout(a),a=setTimeout(function(){u.timezonePicker("resize")},200)})}setTimeout(function(){n.responsive&&parseInt(i.width)!==parseInt(i.getAttribute("width"))?u.timezonePicker("resize"):n.maphilight&&e.fn.maphilight&&e(i).maphilight(n),n.target&&e(n.target).triggerHandler("change")},500)})},t.updateTimezone=function(t){return r=t,o.css("display","none"),e(s).find("area").each(function(t,n){if(n.getAttribute("data-timezone")===r)return e(n).triggerHandler("click"),!1}),this},t.detectLocation=function(t){function n(n){var r=e(i),f=o(n.coords.latitude,n.coords.longitude,r.width(),r.height());e(s).find("area").each(function(n,r){var i=r.getAttribute("coords").split(","),s=r.getAttribute("shape"),o=[];for(var l=0;l<i.length/2;l++)o[l]=[i[l*2],i[l*2+1]];if(s==="poly"&&u(o,f[0],f[1])||s==="rect"&&a(i,f[0],f[1]))return e(r).triggerHandler("click",t.success),!1}),t.complete&&t.complete(n)}function r(e){t.error&&t.error(e),t.complete&&t.complete(e)}function o(e,t,n,r){var i=Math.round((t+180)*(n/360)),s=Math.round((e*-1+90)*(r/180));return[i,s]}function u(e,t,n){var r=!1,i=[1e6,1e6,-1e6,-1e6];for(var s=0,o=e.length-1;s<e.length;o=s++){var u=e[s][0],f=e[s][1],l=e[o][0],c=e[o][1];i[0]=Math.min(i[0],u),i[1]=Math.min(i[1],f),i[2]=Math.max(i[2],u),i[3]=Math.max(i[3],f);var h=f>n!=c>n&&t<(l-u)*(n-f)/(c-f)+u;h&&(r=!r)}return r&&a(i,t,n)}function a(e,t,n){return e=[Math.min(e[0],e[2]),Math.min(e[1],e[3]),Math.max(e[0],e[2]),Math.max(e[1],e[3])],t>=e[0]&&t<=e[2]&&n>=e[1]&&n<=e[2]}return t=e.extend({},e.fn.timezonePicker.detectLocation.defaults,t),navigator.geolocation&&navigator.geolocation.getCurrentPosition(n,r),this},t.resize=function(){return e(s).find("area").each(function(t,r){r.originalCoords||(r.originalCoords={timezone:r.getAttribute("data-timezone"),country:r.getAttribute("data-country"),coords:r.getAttribute("coords"),pin:r.getAttribute("data-pin")});var s=i.width/i.getAttribute("width");e(i).parent().css({width:e(i).width()+"px"});var o=r.originalCoords.coords.split(","),u=new Array;for(var a=0;a<o.length;a++)u[a]=Math.round(parseInt(o[a])*s);r.setAttribute("coords",u.join(","));var f=r.originalCoords.pin.split(",");f[0]=Math.round(parseInt(f[0])*s),f[1]=Math.round(parseInt(f[1])*s),r.setAttribute("data-pin",f.join(",")),n.target&&e(n.target).triggerHandler("change")}),this},e.fn.timezonePicker=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return t.init.apply(this,arguments);e.error("Method "+n+" does not exist on jQuery.timezonePicker")},e.fn.timezonePicker.defaults={pin:".timezone-pin",pinUrl:null,timezone:null,maphilight:!0,target:null,countryTarget:null,responsive:!1,fade:!1,stroke:!0,strokeColor:"FFFFFF",strokeOpacity:.4,fillColor:"FFFFFF",fillOpacity:.4,groupBy:"data-offset"},e.fn.timezonePicker.detectLocation.defaults={success:undefined,error:undefined,complete:undefined}})(jQuery);